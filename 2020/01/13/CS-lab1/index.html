<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/sweet.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/sweet.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="FAT12æ–‡ä»¶ç³»ç»Ÿ åŸºæœ¬ç»“æ„   FATæ–‡ä»¶ç³»ç»ŸæŠŠå­˜å‚¨ä»‹è´¨çœ‹æˆä¸€ä½çš„æ•°ç»„ï¼ŒåŸºæœ¬å•ä½æ˜¯ç°‡ã€‚   ä¸€ä¸ªç°‡åŒ…å«ä¸€ä¸ªæ‰‡åŒºï¼Œå¤§å°ä¸º512B">
<meta property="og:type" content="article">
<meta property="og:title" content="nasm&amp;c++ è¯»å–FAT12æ–‡ä»¶ç³»ç»Ÿ">
<meta property="og:url" content="http://yoursite.com/2020/01/13/CS-lab1/index.html">
<meta property="og:site_name" content="sweet&#39;s blog">
<meta property="og:description" content="FAT12æ–‡ä»¶ç³»ç»Ÿ åŸºæœ¬ç»“æ„   FATæ–‡ä»¶ç³»ç»ŸæŠŠå­˜å‚¨ä»‹è´¨çœ‹æˆä¸€ä½çš„æ•°ç»„ï¼ŒåŸºæœ¬å•ä½æ˜¯ç°‡ã€‚   ä¸€ä¸ªç°‡åŒ…å«ä¸€ä¸ªæ‰‡åŒºï¼Œå¤§å°ä¸º512B">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113213415437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0MjgzNg==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113213536221.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0MjgzNg==,size_16,color_FFFFFF,t_70">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113213526412.gif">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113213616253.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113213625585.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200113213635556.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2020011321364255.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0MjgzNg==,size_16,color_FFFFFF,t_70">
<meta property="article:published_time" content="2020-01-13T09:24:46.000Z">
<meta property="article:modified_time" content="2020-01-14T06:34:47.918Z">
<meta property="article:author" content="ZTT">
<meta property="article:tag" content="OS_LAB">
<meta property="article:tag" content="2020&#x2F;1">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200113213415437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0MjgzNg==,size_16,color_FFFFFF,t_70">

<link rel="canonical" href="http://yoursite.com/2020/01/13/CS-lab1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>nasm&c++ è¯»å–FAT12æ–‡ä»¶ç³»ç»Ÿ | sweet's blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-156160607-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-156160607-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">sweet's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/13/CS-lab1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ZTT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sweet's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          nasm&c++ è¯»å–FAT12æ–‡ä»¶ç³»ç»Ÿ
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-01-13 17:24:46" itemprop="dateCreated datePublished" datetime="2020-01-13T17:24:46+08:00">2020-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-01-14 14:34:47" itemprop="dateModified" datetime="2020-01-14T14:34:47+08:00">2020-01-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OS-LAB/" itemprop="url" rel="index">
                    <span itemprop="name">OS_LAB</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020/01/13/CS-lab1/" class="post-meta-item leancloud_visitors" data-flag-title="nasm&c++ è¯»å–FAT12æ–‡ä»¶ç³»ç»Ÿ" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/2020/01/13/CS-lab1/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/13/CS-lab1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="FAT12æ–‡ä»¶ç³»ç»Ÿ">FAT12æ–‡ä»¶ç³»ç»Ÿ</h2>
<h3 id="åŸºæœ¬ç»“æ„">åŸºæœ¬ç»“æ„</h3>
<ul>
<li>
<p>FATæ–‡ä»¶ç³»ç»ŸæŠŠå­˜å‚¨ä»‹è´¨çœ‹æˆä¸€ä½çš„æ•°ç»„ï¼ŒåŸºæœ¬å•ä½æ˜¯ç°‡ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªç°‡åŒ…å«ä¸€ä¸ªæ‰‡åŒºï¼Œå¤§å°ä¸º512B</p>
<a id="more"></a>
</li>
<li>
<p>å­˜å‚¨ä»‹è´¨åˆ’åˆ†ä¸º3ä¸ªåŒºåŸŸï¼šbootï¼ŒFATï¼Œdirectory and data area</p>
</li>
<li>
<img src="https://img-blog.csdnimg.cn/20200113213415437.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0MjgzNg==,size_16,color_FFFFFF,t_70" alt="å›¾ç‰‡1" style="zoom:40%;" />
</li>
</ul>
<h3 id="å¼•å¯¼æ‰‡åŒºBOOT">å¼•å¯¼æ‰‡åŒºBOOT</h3>
<table>
<thead>
<tr>
<th>BS_jmpBOOT</th>
<th>0</th>
<th>3</th>
<th>ä¸€ä¸ªçŸ­è·³è½¬æŒ‡ä»¤</th>
<th>jmp short LABEL_STARTnop</th>
</tr>
</thead>
<tbody>
<tr>
<td>BS_OEMName</td>
<td>3</td>
<td>8</td>
<td>å‚å•†å</td>
<td>â€˜ZGHâ€™</td>
</tr>
<tr>
<td>BPB_BytesPerSec</td>
<td>11</td>
<td>2</td>
<td>æ¯æ‰‡åŒºå­—èŠ‚æ•°ï¼ˆBytes/Sectorï¼‰</td>
<td>0x200</td>
</tr>
<tr>
<td>BPB_SecPerClus</td>
<td>13</td>
<td>1</td>
<td>æ¯ç°‡æ‰‡åŒºæ•°ï¼ˆSector/Clusterï¼‰</td>
<td>0x1</td>
</tr>
<tr>
<td>BPB_ResvdSecCnt</td>
<td>14</td>
<td>2</td>
<td>Bootè®°å½•å ç”¨å¤šå°‘æ‰‡åŒº</td>
<td>ox1</td>
</tr>
<tr>
<td>BPB_NumFATs</td>
<td>16</td>
<td>1</td>
<td>å…±æœ‰å¤šå°‘FATè¡¨</td>
<td>0x2</td>
</tr>
<tr>
<td>BPB_RootEntCnt</td>
<td>17</td>
<td>2</td>
<td>æ ¹ç›®å½•åŒºæ–‡ä»¶æœ€å¤§æ•°</td>
<td>0xE0</td>
</tr>
<tr>
<td>BPB_TotSec16</td>
<td>19</td>
<td>2</td>
<td>æ‰‡åŒºæ€»æ•°</td>
<td>0xB40</td>
</tr>
<tr>
<td>BPB_Media</td>
<td>21</td>
<td>1</td>
<td>ä»‹è´¨æè¿°ç¬¦</td>
<td>0xF0</td>
</tr>
<tr>
<td>BPB_FATSz16</td>
<td>22</td>
<td>2</td>
<td>æ¯ä¸ªFATè¡¨æ‰€å æ‰‡åŒºæ•°</td>
<td>0x9</td>
</tr>
<tr>
<td>BPB_SecPerTrk</td>
<td>24</td>
<td>2</td>
<td>æ¯ç£é“æ‰‡åŒºæ•°ï¼ˆSector/trackï¼‰</td>
<td>0x12</td>
</tr>
<tr>
<td>BPB_NumHeads</td>
<td>26</td>
<td>2</td>
<td>ç£å¤´æ•°ï¼ˆé¢æ•°ï¼‰</td>
<td>0x2</td>
</tr>
<tr>
<td>BPB_HiddSec</td>
<td>28</td>
<td>4</td>
<td>éšè—æ‰‡åŒºæ•°</td>
<td>0</td>
</tr>
<tr>
<td>BPB_TotSec32</td>
<td>32</td>
<td>4</td>
<td>å¦‚æœBPB_TotSec16=0,åˆ™ç”±è¿™é‡Œç»™å‡ºæ‰‡åŒºæ•°</td>
<td>0</td>
</tr>
<tr>
<td>BS_DrvNum</td>
<td>36</td>
<td>1</td>
<td>INT 13Hçš„é©±åŠ¨å™¨å·</td>
<td>0</td>
</tr>
<tr>
<td>BS_Reserved1</td>
<td>37</td>
<td>1</td>
<td>ä¿ç•™ï¼Œæœªä½¿ç”¨</td>
<td>0</td>
</tr>
<tr>
<td>BS_BootSig</td>
<td>38</td>
<td>1</td>
<td>æ‰©å±•å¼•å¯¼æ ‡è®°(29h)</td>
<td>0x29</td>
</tr>
<tr>
<td>BS_VolID</td>
<td>39</td>
<td>4</td>
<td>å·åºåˆ—å·</td>
<td>0</td>
</tr>
<tr>
<td>BS_VolLab</td>
<td>43</td>
<td>11</td>
<td>å·æ ‡</td>
<td>â€˜ZGHâ€™</td>
</tr>
<tr>
<td>BS_FileSysType</td>
<td>54</td>
<td>8</td>
<td>æ–‡ä»¶ç³»ç»Ÿç±»å‹</td>
<td>â€˜FAT12â€™</td>
</tr>
<tr>
<td>å¼•å¯¼ä»£ç åŠå…¶ä»–å†…å®¹</td>
<td>62</td>
<td>448</td>
<td>å¼•å¯¼ä»£ç åŠå…¶ä»–æ•°æ®</td>
<td>å¼•å¯¼ä»£ç ï¼ˆå‰©ä½™ç©ºé—´ç”¨0å¡«å……ï¼‰</td>
</tr>
<tr>
<td>ç»“æŸæ ‡å¿—0xAA55</td>
<td>510</td>
<td>2</td>
<td>ç¬¬510å­—èŠ‚ä¸º0x55ï¼Œç¬¬511å­—èŠ‚ä¸º0xAA</td>
<td>0xAA55</td>
</tr>
</tbody>
</table>
<h3 id="FAT-File-Allocation-Table">FAT-File Allocation Table</h3>
<ul>
<li>
<p>FAT1å’ŒFAT2äº’ä¸ºå¤‡ä»½ã€‚</p>
</li>
<li>
<p>æ¯12ä½æˆä¸ºä¸€ä¸ªFATé¡¹(FATEntry)ï¼Œä»£è¡¨ä¸€ä¸ªç°‡ã€‚æ‰€ä»¥2ä¸ªFATé¡¹ä¼šå ç”¨3ä¸ªå­—èŠ‚</p>
</li>
<li>
<p>æ•°æ®åŒºèµ·å§‹äºç°‡2,why?</p>
<p>-åœ¨1.44Mè½¯ç›˜ä¸Šï¼ŒFATå‰ä¸‰ä¸ªå­—èŠ‚çš„å€¼æ˜¯å›ºå®šçš„0xF0ã€0xFFã€0xFFï¼Œç”¨äºè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåº”ç”¨åœ¨1.44Mè½¯ç›˜ä¸Šçš„FAT12æ–‡ä»¶ç³»ç»Ÿã€‚æœ¬æ¥åºå·ä¸º0å’Œ1çš„FATè¡¨é¡¹åº”è¯¥å¯¹åº”äºç°‡0å’Œç°‡1ï¼Œä½†æ˜¯ç”±äºè¿™ä¸¤ä¸ªè¡¨é¡¹è¢«è®¾ç½®æˆäº†å›ºå®šå€¼ï¼Œç°‡0å’Œç°‡1å°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰.</p>
</li>
<li>
<p>FATé¡¹çš„å€¼ä»£è¡¨æ–‡ä»¶çš„ä¸‹ä¸€ä¸ªç°‡å·</p>
<ul>
<li>å€¼ä¸º0xFF7ï¼Œè¡¨ç¤ºåç°‡</li>
<li>å€¼å¤§äºæˆ–ç­‰äº0xFF8ï¼Œè¡¨ç¤ºå½“å‰ç°‡æ˜¯æœ¬æ–‡ä»¶çš„æœ€åä¸€ä¸ªç°‡</li>
</ul>
</li>
<li>
<p><img src="https://img-blog.csdnimg.cn/20200113213536221.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0MjgzNg==,size_16,color_FFFFFF,t_70" alt=""></p>
</li>
</ul>
<h3 id="æ ¹ç›®å½•åŒº">æ ¹ç›®å½•åŒº</h3>
<ul>
<li>æ ¹ç›®å½•åŒºç”±ç›®å½•é¡¹ç»„æˆï¼Œä¸€ä¸ªç›®å½•é¡¹å 32ä¸ªå­—èŠ‚ã€‚</li>
<li><img src="https://img-blog.csdnimg.cn/20200113213526412.gif" alt=""></li>
</ul>
<h2 id="g-ä¸nasmæ··åˆç¼–ç¨‹">g++ä¸nasmæ··åˆç¼–ç¨‹</h2>
<ul>
<li>
<p>ç¯å¢ƒubuntu64ï¼Œå®‰è£…g++,nasm</p>
</li>
<li>
<p>my_print.asmè´Ÿè´£è¾“å‡ºï¼Œ1.cppä¸ºä¸»æ–‡ä»¶</p>
</li>
<li>
<p>1.cppä¸­é¦–å…ˆå£°æ˜å‡½æ•°</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> <span class="function"><span class="keyword">void</span> <span class="title">my_print</span><span class="params">(<span class="keyword">char</span> *, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>my_print.asmå®šä¹‰å‡½æ•°ï¼Œæ³¨æ„ç”¨global my_printå£°æ˜å‡½æ•°åã€‚</p>
</li>
<li>
<p>å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ nasm -f elf32 my_print.asm</span><br><span class="line">$ g++ -o fat -m32 1.cpp my_print.o</span><br><span class="line">$ .&#x2F;fat</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="å¦‚ä½•è¯»å–FAT12æ–‡ä»¶ï¼Ÿ">å¦‚ä½•è¯»å–FAT12æ–‡ä»¶ï¼Ÿ</h2>
<h3 id="Steps">Steps</h3>
<ol>
<li>
<p>è¯»å–Bootï¼Œå¾—åˆ°å¿…è¦çš„å‚æ•°ï¼š</p>
<ul>
<li>BPB_BytsPerSec <em>æ¯æ‰‡åŒºå­—èŠ‚æ•°</em></li>
<li>BPB_SecPerClus <em>æ¯ç°‡æ‰‡åŒºæ•°</em></li>
<li>BPB_RsvdSecCnt <em>Bootè®°å½•å ç”¨çš„æ‰‡åŒºæ•°</em></li>
<li>BPB_NumFATs  <em>FATè¡¨ä¸ªæ•°</em></li>
<li>BPB_RootEntCnt <em>æ ¹ç›®å½•æœ€å¤§æ–‡ä»¶æ•°</em></li>
<li>BPB_TotSec16 <em>FATæ‰‡åŒºæ•°ï¼Œå¦‚æœè¯¥å€¼ä¸º0ï¼Œåˆ™BPB_FATSz32ä¸ºFATæ‰‡åŒºæ•°</em></li>
<li>BPB_HiddSec</li>
</ul>
</li>
<li>
<p>è®¡ç®—æ¯ç°‡çš„å­—èŠ‚æ•°ï¼Œæ¯ä¸ªåŒºåŸŸçš„åˆå§‹ä½ç½®çš„åç§»é‡ã€‚</p>
<ul>
<li>æ¯ç°‡å­—èŠ‚æ•°=æ¯ç°‡æ‰‡åŒºæ•°*æ¯æ‰‡åŒºå­—èŠ‚æ•°ã€‚</li>
<li>fatBase=Bootè®°å½•å ç”¨çš„æ‰‡åŒºæ•°*æ¯æ‰‡åŒºå­—èŠ‚æ•°</li>
<li>fileRootBase=ï¼ˆBootè®°å½•å ç”¨çš„æ‰‡åŒºæ•°+FATè¡¨ä¸ªæ•°* FATæ‰‡åŒºæ•°ï¼‰*æ¯æ‰‡åŒºå­—èŠ‚æ•°</li>
<li>dataBase=ï¼ˆBootè®°å½•å ç”¨çš„æ‰‡åŒºæ•°+FATè¡¨ä¸ªæ•°* FATæ‰‡åŒºæ•°+ï¼ˆæ ¹ç›®å½•æœ€å¤§æ–‡ä»¶æ•°* 32+æ¯æ‰‡åŒºå­—èŠ‚æ•°-1ï¼‰/æ¯æ‰‡åŒºå­—èŠ‚æ•°ï¼‰*æ¯æ‰‡åŒºå­—èŠ‚æ•°ã€‚</li>
</ul>
<p>æ•°æ®åŒºçš„åç§»é‡åˆä¹˜åˆé™¤æ˜¯ä¸æ˜¯åƒé¥±äº†æ’‘çš„0.0ï¼Ÿå¯ä¸å¯ä»¥ç­‰äºfileRootBase+æ ¹ç›®å½•æœ€å¤§æ–‡ä»¶æ•°*32ï¼Ÿä¸é˜”ä»¥ï¼</p>
<p>dataBaseåˆå§‹ä½ç½®=FileRootBaseæœ€åä¸€ä¸ªç°‡çš„ç»“æŸä½ç½®ã€‚å¦‚æœæ ¹ç›®å½•æ²¡æœ‰å¡«æ»¡æœ€åä¸€ä¸ªç°‡ï¼Œæ•°æ®åŒºä¹Ÿæ˜¯ä»ä¸‹ä¸€ä¸ªç°‡å¼€å§‹çš„ï¼Œè€Œä¸æ˜¯é»˜è®¤äºæœ€åä¸€ä¸ªæ ¹ç›®å½•çš„ç»“æŸä½ç½®å¼€å§‹ã€‚</p>
<p>ç”¨ <em><em>ï¼ˆæ ¹ç›®å½•æœ€å¤§æ–‡ä»¶æ•°</em> 32+æ¯æ‰‡åŒºå­—èŠ‚æ•°-1ï¼‰/æ¯æ‰‡åŒºå­—èŠ‚æ•°</em>* å¯ä»¥å¾—åˆ°æ ¹ç›®å½•åŒºå ç”¨çš„çœŸæ­£æ‰‡åŒºæ•°ã€‚</p>
</li>
<li>
<p>å¹¿æœéå†Fat12æ–‡ä»¶ç³»ç»Ÿ</p>
<ul>
<li>
<p>é¦–å…ˆè¯»å–æ ¹ç›®å½•åŒº</p>
</li>
<li>
<p>åˆ¤æ–­æ–‡ä»¶å±æ€§</p>
<ul>
<li>ç›®å½•é¡¹çš„å±æ€§è®°å½•äº†è¯¥é¡¹æ˜¯æ–‡ä»¶å¤¹oræ–‡ä»¶</li>
<li>ç”¨DIR_Attr&amp;0x10åˆ¤æ–­ï¼Œç»“æœä¸º0æ˜¯æ–‡ä»¶ï¼Œå¦åˆ™ä¸ºæ–‡ä»¶å¤¹ã€‚</li>
</ul>
</li>
<li>
<p>å¤„ç†æ–‡ä»¶å¤¹</p>
<ul>
<li>
<p>å¾—åˆ°ä¸‹ä¸€å±‚ç›®å½•çš„æ•°æ®åŒºåˆå§‹ä½ç½®ï¼Œé¦–å…ˆéœ€è¦FATå·ã€‚æ–‡ä»¶å¤¹çš„ç›®å½•é¡¹ä¸­DIR_FstClusè®°å½•äº†æ–‡ä»¶å¤¹FATå·(num)ï¼Œå…¶å†…å®¹å³ä¸ºæ‰€éœ€FATå·ã€‚</p>
<ul>
<li>
<p>FATé¡¹å¤§å°ä¸º12ä½ã€‚</p>
</li>
<li>
<p>ä»fatBase + num * 3 / 2è¯»å–2ä¸ªå­—èŠ‚ï¼ˆ16ä½ï¼‰ã€‚ç»“åˆå­˜å‚¨çš„å°å°¾é¡ºåºå’ŒFATé¡¹ç»“æ„å¯ä»¥å¾—åˆ°ã€‚numä¸ºå¶å»æ‰é«˜4ä½,numä¸ºå¥‡å»æ‰ä½4ä½ã€‚</p>
</li>
<li>
<p>(num &amp; 1) ? (bytes &gt;&gt; 4) : (bytes &amp; ((1 &lt;&lt; 12) - 1))ä¸ºä¸‹ä¸€ä¸ªFATå·</p>
</li>
</ul>
</li>
<li>
<p>ç”¨FATå·è®¡ç®—åœ¨æ•°æ®åŒºä¸­çš„ä½ç½®ã€‚</p>
<ul>
<li>startByte <strong>=</strong> dataBase <strong>+</strong> (fatå·- 2) ***** BytsPerClus;</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å¤„ç†æ™®é€šæ–‡ä»¶</p>
<ul>
<li>å¦‚æœæ–‡ä»¶åœ¨æ•°æ®åŒºä¸­éœ€è¦å¤šä¸ªç°‡ï¼Œé‚£ä¹ˆç”¨ä¸Šé¢çš„åŠæ³•è¯»å–æ•°æ®ã€‚</li>
</ul>
</li>
<li>
<p>å¹¿æœéå†</p>
<ul>
<li>åˆ†å±‚éå†</li>
<li>æ¯ä¸€å±‚çš„æ–‡ä»¶å¤¹æ”¾è¿›é˜Ÿåˆ—ã€‚</li>
<li>é˜Ÿåˆ—ä¸ºç©ºåˆ™åœæ­¢</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="ç”¨æ–‡ä»¶åæŸ¥è¯¢ç‰¹å®šæ–‡ä»¶">ç”¨æ–‡ä»¶åæŸ¥è¯¢ç‰¹å®šæ–‡ä»¶</h2>
<ol>
<li>å¯¹äºç›®å½•é¡¹ä¸­çš„æ–‡ä»¶ååšå¤„ç†ï¼Œå»é™¤éæ³•å­—ç¬¦å’Œç©ºæ ¼ã€‚å¦‚æœæ˜¯æ™®é€šæ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªç©ºæ ¼ä¸ºâ€˜.â€™ã€‚</li>
<li>åˆ¤æ–­æ–‡ä»¶åæ˜¯å¦ç›¸ç­‰ï¼Œstrcmpç­‰ç­‰å„ç§æ–¹æ³•éƒ½å¯ã€‚</li>
</ol>
<h2 id="åˆ¶ä½œFATé•œåƒ">åˆ¶ä½œFATé•œåƒ</h2>
<ol>
<li>
<p>åˆ›å»ºæ–°çš„è½¯ç›˜é•œåƒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat -C a.img 1440</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŒ‚è½½ç‚¹ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir æ–‡ä»¶å</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å°†é•œåƒæŒ‚è½½åˆ°æŒ‚è½½ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount a.img æ–‡ä»¶å</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŒ‚è½½åï¼Œå°±å¯ä»¥é€šè¿‡æ“ä½œ./mountæ–‡ä»¶å¤¹ï¼Œæ¥å‘a.imgåŠ å…¥å’ŒæŸ¥çœ‹æ–‡ä»¶ã€‚å¯ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„èµ„æºç®¡ç†å™¨ç±»ä¼¼ GUIå·¥å…·ï¼Œæˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œæ“ä½œã€‚</p>
</li>
</ol>
<h2 id="æˆ‘çš„å‘†ç ğŸ‘‰-click-me">æˆ‘çš„å‘†ç ğŸ‘‰  <a href="https://github.com/emsweet/OS_LAB/tree/master/lab1" target="_blank" rel="noopener">click me</a></h2>
<p>æ”¯æŒlsï¼Œcat æ–‡ä»¶åï¼Œls -l[lll] [æ–‡ä»¶å],ls [æ–‡ä»¶å] -l[lll] .</p>
<p><img src="https://img-blog.csdnimg.cn/20200113213616253.png" alt="image-20200113204622190"></p>
<p><img src="https://img-blog.csdnimg.cn/20200113213625585.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<img src="https://img-blog.csdnimg.cn/20200113213635556.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" />
<img src="https://img-blog.csdnimg.cn/2020011321364255.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzI0MjgzNg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:80%;" />
<h2 id="reference">reference</h2>
<p><a href="https://blog.csdn.net/qq_39654127/article/details/88429461#main-toc" target="_blank" rel="noopener">https://blog.csdn.net/qq_39654127/article/details/88429461#main-toc</a></p>
<p><a href="https://blog.csdn.net/judyge/article/details/52373751" target="_blank" rel="noopener">https://blog.csdn.net/judyge/article/details/52373751</a></p>
<p><a href="https://blog.csdn.net/yxc135/article/details/8769086" target="_blank" rel="noopener">https://blog.csdn.net/yxc135/article/details/8769086</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/OS-LAB/" rel="tag"># OS_LAB</a>
              <a href="/tags/2020-1/" rel="tag"># 2020/1</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/13/hello/" rel="prev" title="hi this is sweet's blog">
      <i class="fa fa-chevron-left"></i> hi this is sweet's blog
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#FAT12æ–‡ä»¶ç³»ç»Ÿ"><span class="nav-number">1.</span> <span class="nav-text">FAT12æ–‡ä»¶ç³»ç»Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#åŸºæœ¬ç»“æ„"><span class="nav-number">1.1.</span> <span class="nav-text">åŸºæœ¬ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¼•å¯¼æ‰‡åŒºBOOT"><span class="nav-number">1.2.</span> <span class="nav-text">å¼•å¯¼æ‰‡åŒºBOOT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FAT-File-Allocation-Table"><span class="nav-number">1.3.</span> <span class="nav-text">FAT-File Allocation Table</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ ¹ç›®å½•åŒº"><span class="nav-number">1.4.</span> <span class="nav-text">æ ¹ç›®å½•åŒº</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#g-ä¸nasmæ··åˆç¼–ç¨‹"><span class="nav-number">2.</span> <span class="nav-text">g++ä¸nasmæ··åˆç¼–ç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¦‚ä½•è¯»å–FAT12æ–‡ä»¶ï¼Ÿ"><span class="nav-number">3.</span> <span class="nav-text">å¦‚ä½•è¯»å–FAT12æ–‡ä»¶ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Steps"><span class="nav-number">3.1.</span> <span class="nav-text">Steps</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç”¨æ–‡ä»¶åæŸ¥è¯¢ç‰¹å®šæ–‡ä»¶"><span class="nav-number">4.</span> <span class="nav-text">ç”¨æ–‡ä»¶åæŸ¥è¯¢ç‰¹å®šæ–‡ä»¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åˆ¶ä½œFATé•œåƒ"><span class="nav-number">5.</span> <span class="nav-text">åˆ¶ä½œFATé•œåƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æˆ‘çš„å‘†ç ğŸ‘‰-click-me"><span class="nav-number">6.</span> <span class="nav-text">æˆ‘çš„å‘†ç ğŸ‘‰  click me</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reference"><span class="nav-number">7.</span> <span class="nav-text">reference</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ZTT</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/emsweet" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;emsweet" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:emsweet101100@gmail.com" title="E-Mail â†’ mailto:emsweet101100@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-heart"></i>
      friends
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://fomalhauthmj.github.io/" title="https:&#x2F;&#x2F;fomalhauthmj.github.io&#x2F;" rel="noopener" target="_blank">åŒ—è½å¸ˆé—¨</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZTT</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el: '#valine-comments',
      verify: false,
      notify: true,
      appId: 'KhWpFuNTUWIbUSCMDbOBadEh-gzGzoHsz',
      appKey: '8v9NLFNBNVgfAc25HFa9G9rq',
      placeholder: "åŠ å…¥è®¨è®º~",
      avatar: 'mm',
      meta: guest,
      pageSize: '8' || 10,
      visitor: true,
      lang: '' || 'zh-cn',
      path: location.pathname,
      recordIP: false,
      serverURLs: ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
